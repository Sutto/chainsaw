var Chainsaw={Util:{},spinderella:null,processors:{},loadExisting:false,streamURL:"",callbackCount:0,onReadyCallbacks:[],connected:false,host:"",port:{base:42340,websocket:42342},loadJSONP:function(a,b){var c=this.callbackCount++,e="chainsaw-callback-"+c,f="jsonpCallback"+c;Chainsaw[f]=function(d){typeof b=="function"&&b(d);delete Chainsaw[f];if(d=document.getElementById(e)){d.parentElement.removeChild(d);for(var g in d)delete d[g]}};c="Chainsaw."+f;c=a.indexOf("?")<0?(a="?callback="+c):a.replace("=?",
"="+c);a=document.createElement("script");a.type="text/javascript";a.id=e;a.src=c;document.getElementsByTagName("head")[0].appendChild(a)},urlForStream:function(a,b){a=this.streamURL.replace("IDENTIFIER",a);if(b)a+=b;return a},subscribe:function(a){this.spinderella.client.subscribe(["chainsaw/"+a])},watch:function(a,b){if(b!==false&&b!==true)b=this.loadExisting;var c=this,e=function(){c.subscribe(a)};b?this.loadJSONP(this.urlForStream(a),function(f){for(var d=f.length;d>0;d--)this.receiveFromStream(f[d-
1],a);e()}):e()},watchAll:function(){for(var a=arguments.length,b=0;b<a;b++)this.watchAll(arguments[b])},onMessage:function(a,b){if(typeof b=="function")this.processors[a]=b},onReady:function(a){typeof a=="function"&&this.onReadyCallbacks.push(a)},ready:function(){for(var a=this.onReadyCallbacks.length,b=0;b<a;b++)this.onReadyCallbacks[b]();this.onReadyCallbacks=[]},alias:function(a,b){this.onMessage(b,function(c,e){Chainsaw.processors[a](msg,e)})},init:function(a,b){if(this.spinderella==null){if(!a)a=
this.host;if(!port)b=this.ports;this.spinderella=Spinderella.create(a,b);var c=this;this.spinderella.onMessage(function(){c.receiveMessage.apply(c,arguments)})}},connect:function(a){if(!this.connected){this.onReady(a);this.init();this.spinderella.connect(function(){Chainsaw.connected=true;Chainsaw.ready()})}},receiveMessage:function(a,b,c){switch(b){case "channel":this.receiveFromStream(JSON.parse(a),c.channel.replace(/^chainsaw\//,""));break;default:eval(a);break}},receiveFromStream:function(a,b){var c=
this.processors[b];if(c)with(this.Util)c(a,b)}};
